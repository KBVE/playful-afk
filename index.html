<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<title>Virtual Pet AFK</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			background-color: #000000;
			overflow: hidden;
			touch-action: none;
			position: fixed;
			width: 100%;
			height: 100%;
			-webkit-user-select: none;
			-moz-user-select: none;
			user-select: none;
		}

		#canvas-container {
			width: 100%;
			height: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			overflow: hidden;
		}

		#canvas {
			display: block;
			outline: none;
			touch-action: none;
			-webkit-tap-highlight-color: transparent;
		}

		#status {
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -50%);
			color: #ffffff;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			font-size: 16px;
			text-align: center;
		}

		#game-title {
			position: absolute;
			left: 50%;
			top: 40%;
			transform: translate(-50%, -50%);
			color: #ffffff;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			font-size: 48px;
			font-weight: bold;
			text-align: center;
			letter-spacing: 2px;
			text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
		}

		#status-progress {
			width: 240px;
			height: 6px;
			background-color: rgba(255, 255, 255, 0.2);
			border-radius: 3px;
			margin: 16px auto 0;
			overflow: hidden;
		}

		#status-progress-inner {
			height: 100%;
			width: 0%;
			background-color: #4a90e2;
			border-radius: 3px;
			transition: width 0.2s ease;
		}

		#status-indeterminate {
			height: 6px;
			width: 240px;
			margin: 16px auto 0;
			background-color: rgba(255, 255, 255, 0.2);
			border-radius: 3px;
			overflow: hidden;
			display: none;
		}

		#status-indeterminate > div {
			width: 50%;
			height: 100%;
			background-color: #4a90e2;
			border-radius: 3px;
			animation: indeterminate 2s linear infinite;
		}

		@keyframes indeterminate {
			0% { transform: translateX(-100%); }
			100% { transform: translateX(300%); }
		}

		#status-notice {
			margin-top: 16px;
			font-size: 14px;
			color: rgba(255, 255, 255, 0.7);
		}
	</style>
</head>
<body>
	<div id="canvas-container">
		<canvas id="canvas">
			Your browser does not support the canvas element.
		</canvas>
	</div>

	<div id="game-title">Virtual Pet AFK</div>

	<div id="status">
		<div id="status-progress">
			<div id="status-progress-inner"></div>
		</div>
		<div id="status-indeterminate">
			<div></div>
		</div>
		<div id="status-notice"></div>
	</div>

	<script src="index.js"></script>
	<script>
		const GODOT_CONFIG = {"args":[],"canvasResizePolicy":2,"emscriptenPoolSize":8,"ensureCrossOriginIsolationHeaders":true,"executable":"index","experimentalVK":false,"fileSizes":{"index.pck":6024496,"index.wasm":1660816},"focusCanvas":true,"gdextensionLibs":[],"godotPoolSize":4,"serviceWorker":"index.service.worker.js"};
		const EXECUTABLE_NAME = GODOT_CONFIG['executable'];
		const MAIN_PACK = GODOT_CONFIG['mainPack'];

		const statusElement = document.getElementById('status');
		const statusProgressElement = document.getElementById('status-progress');
		const statusProgressInnerElement = document.getElementById('status-progress-inner');
		const statusIndeterminateElement = document.getElementById('status-indeterminate');
		const statusNoticeElement = document.getElementById('status-notice');
		const gameTitleElement = document.getElementById('game-title');
		const canvasElement = document.getElementById('canvas');

		let initializing = true;
		let gameStarted = false;

		function setStatusMode(mode) {
			if (mode === 'hidden') {
				statusElement.style.display = 'none';
				gameTitleElement.style.display = 'none';
			} else {
				statusElement.style.display = 'block';
				gameTitleElement.style.display = 'block';
				statusProgressElement.style.display = mode === 'progress' ? 'block' : 'none';
				statusIndeterminateElement.style.display = mode === 'indeterminate' ? 'block' : 'none';
			}
		}

		function setStatusNotice(text) {
			statusNoticeElement.textContent = text;
		}

		function setStatusProgress(progress) {
			if (progress < 0) {
				progress = 0;
			}
			if (progress > 1) {
				progress = 1;
			}
			statusProgressInnerElement.style.width = (progress * 100) + '%';
		}

		function displayFailureNotice(message) {
			setStatusMode('indeterminate');
			setStatusNotice(message);
			initializing = false;
			gameStarted = false;
		}

		const engine = new Engine(GODOT_CONFIG);

		engine.startGame({
			'onProgress': function(current, total) {
				if (current > 0 && total > 0) {
					const percentage = Math.round((current / total) * 100);
					setStatusMode('progress');
					setStatusProgress(current / total);
					setStatusNotice('Loading... ' + percentage + '%');
				} else {
					setStatusMode('indeterminate');
					setStatusNotice('Loading...');
				}
			},
		}).then(() => {
			setStatusMode('hidden');
			initializing = false;
			gameStarted = true;
			// Focus canvas for input
			canvasElement.focus();
		}, (err) => {
			displayFailureNotice('Error: ' + err);
		});

		// Prevent context menu on long press for mobile
		canvasElement.addEventListener('contextmenu', (e) => {
			e.preventDefault();
			return false;
		});

		// Prevent default touch behaviors
		document.body.addEventListener('touchstart', (e) => {
			if (gameStarted && e.target === canvasElement) {
				e.preventDefault();
			}
		}, { passive: false });

		document.body.addEventListener('touchmove', (e) => {
			if (gameStarted && e.target === canvasElement) {
				e.preventDefault();
			}
		}, { passive: false });

		// Handle window resize for responsive canvas
		window.addEventListener('resize', () => {
			if (gameStarted) {
				canvasElement.focus();
			}
		});
	</script>
</body>
</html>
